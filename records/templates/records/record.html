<!DOCTYPE html>
<html lang="en">
{% extends 'main.html' %}
{% load static %}
<body>
{% block content %}
<section>
    <div class="cycle-info">
        <!--display genetics if name not provided-->
        {% if cycle.name %}
        <h1>{{ cycle.name }}</h1>
        {% else %}
        <h1>{{ cycle.genetics }}</h1>
        {% endif %}
    </div>

    <div class="tbl-header">
        <thead>
        <tr>
            <th class="cyc-info"><strong>Start:</strong> {{ cycle.date|date:"d/m/Y" }}</th>
            <!--display genetics if name provided-->
            {% if cycle.name %}
            <th class="cyc-info"><strong>Genetics:</strong> {{ cycle.genetics }}</th>
            {% endif %}
            <th class="cyc-info"><strong>Seedbank:</strong> {{ cycle.seedbank|default:"Unknown"|title }},</th>
            <!--display 'behavioral_response', 'seed_type', 'grow_medium' only if exists-->
            {% if cycle.behavioral_response %}
            <th class="cyc-info">{{ cycle.behavioral_response|title }},</th>
            {% endif %}
            {% if cycle.seed_type %}
            <th class="cyc-info">{{ cycle.seed_type|title }}</th>
            {% endif %}
            {% if cycle.grow_medium %}
            <th class="cyc-info"><strong>Medium:</strong> {{ cycle.grow_medium|title }}</th>
            {% endif %}
            <th class="cyc-info"><strong>Fixture:</strong> {{ cycle.fixture|title }}</th>
            <!--display buttons for additional options to manipulate the 'Cycle' data-->
            <th><span class="edit-icon" data-href="{% url 'edit_record' cycle.pk %}"
                      onclick="window.open(this.getAttribute('data-href'), '_self')"><i
                    class="fa-solid fa-pen"></i></span></th>

            <th><span class="help-icon"
                      data-href="https://loudclouds.co/wp-content/uploads/2016/07/marijuana-deficiency-chart-jorge-cervantes.jpg"
                      onclick="window.open(this.getAttribute('data-href'), '_blank')"><i
                    class="fa-solid fa-cannabis"></i></span></th>
        </tr>
        </thead>
    </div>

    <br>
    <div class="tbl-header">
        <table cellpadding="0" cellspacing="0" border="0">
            <thead>
            <tr>
                <th style="padding-right: 25px;" rowspan="2">Day</th>
                <th colspan="2">Temperature</th>
                <th colspan="2">Humidity</th>
                <th>pH</th>
                <th>EC</th>
                <th>Light Height</th>
                <th>Light Power</th>
                <th>Calib.</th>
                <th>co2</th>
                <th>Reservoir</th>
                <th>Irrigation</th>
                <th>Recipe</th>
                <th>Note</th>
            </tr>
            <tr>
                <th>Day</th>
                <th>Night</th>
                <th>Day</th>
                <th>Night</th>
                <th>ions</th>
                <th>mS/cm</th>
                <th>cm</th>
                <th>%</th>
                <th></th>
                <th>PPM</th>
                <th>litres</th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
            </thead>
        </table>
    </div>

    <div id="record-content-div" class="tbl-content">
        <table id="record-content-table" cellpadding="0" cellspacing="0" border="0">
            <tbody>
            {% for log in cycle.logs.all %}

            <!--change the row background every 7th day-->
            {% if forloop.counter|divisibleby:7 %}
            <tr style="background-color: rgba(255,255,255,0.1)">
                {% else %}
            <tr>
                {% endif %}
                <!--display log position formatted as: day_in_cycle (day_in_phase) phase-->
                {% if log.date == today %}
                <td style="text-align: left;">
                    {% if log.get_day_in_cycle == log.get_phase_day_in_cycle %}
                    {{ log.get_day_in_cycle }}
                    {% else %}
                    {{ log.get_day_in_cycle }}
                    ({{ log.get_phase_day_in_cycle }})
                    {% endif %}

                    {% if log.phase == "seedling" %}
                    <i class="fa-solid fa-seedling"></i>
                    {% elif log.phase == "vegetative" %}
                    <i class="fa-solid fa-circle"></i>
                    {% elif log.phase == "bloom" %}
                    <i class="fa-solid fa-circle-half-stroke"></i>
                    {% endif %}
                    <div class="online-icon"> </div>
                </td>
                {% else %}
                <td style="text-align: left;">
                    {% if log.get_day_in_cycle == log.get_phase_day_in_cycle %}
                    {{ log.get_day_in_cycle }}
                    {% else %}
                    {{ log.get_day_in_cycle }}
                    ({{ log.get_phase_day_in_cycle }})
                    {% endif %}

                    {% if log.phase == "seedling" %}
                    <i class="fa-solid fa-seedling"></i>
                    {% elif log.phase == "vegetative" %}
                    <i class="fa-solid fa-circle"></i>
                    {% elif log.phase == "bloom" %}
                    <i class="fa-solid fa-circle-half-stroke"></i>
                    {% endif %}
                </td>
                {% endif %}
                <!--display 'temperature_day' in color based on plant phase-->
                <td class="
                    {% if log.temperature_day is not none %}
                        {% if log.phase == 'seedling' %}
                            {% if log.temperature_day <= 18 %} temp-low {% endif %}
                            {% if log.temperature_day >= 22 and log.temperature_day <= 25 %} temp-ideal {% endif %}
                            {% if log.temperature_day >= 26 and log.temperature_day <= 28 %} temp-high {% endif %}
                            {% if log.temperature_day > 28 %} temp-danger {% endif %}
                        {% endif %}
                        {% if log.phase == 'vegetative' %}
                            {% if log.temperature_day <= 18 %} temp-low {% endif %}
                            {% if log.temperature_day >= 22 and log.temperature_day <= 28 %} temp-ideal {% endif %}
                            {% if log.temperature_day > 28 and log.temperature_day <= 30 %} temp-high {% endif %}
                            {% if log.temperature_day > 30 %} temp-danger {% endif %}
                        {% endif %}
                        {% if log.phase == 'bloom' %}
                            {% if log.temperature_day <= 18 %} temp-low {% endif %}
                            {% if log.temperature_day >= 22 and log.temperature_day <= 26 %} temp-ideal {% endif %}
                            {% if log.temperature_day > 26 and log.temperature_day <= 28 %} temp-high {% endif %}
                            {% if log.temperature_day > 28 %} temp-danger {% endif %}
                        {% endif %}
                    {% endif %}
                ">
<!--                   TODO: -->
<!--                    <button onclick="incrementValue({{ log.id }}, {{ cycle.pk }})">+</button>-->
                    <span id="temperature{{ log.id }}">{{ log.temperature_day|default_if_none:''|floatformat:1 }}</span>
                    <!--display 'temperature_night' in color based on value-->
                </td>
                <td class="
                    {% if log.temperature_night is not none %}
                        {% if log.temperature_night <= 18 %} temp-low {% endif %}
                        {% if log.temperature_night >= 25 %} temp-high {% endif %}
                        {% if log.temperature_night >= 28 %} temp-danger {% endif %}
                    {% endif %}
                ">
                    {{ log.temperature_night|default_if_none:''|floatformat:1 }}
                </td>
                <!--display 'humidity_day' in color based on value-->
                <td class="
                    {% if log.humidity_day is not none %}
                        {% if log.humidity_day <= 45 %} hum-low {% endif %}
                        {% if log.humidity_day >= 68 %} hum-high {% endif %}
                        {% if log.humidity_day >= 75 %} hum-danger {% endif %}
                    {% endif %}
                ">
                    {{ log.humidity_day|default_if_none:'' }}
                </td>
                <!--display 'humidity_night' in color based on value-->
                <td class="
                    {% if log.humidity_night is not none %}
                        {% if log.humidity_night <= 45 %} hum-low {% endif %}
                        {% if log.humidity_night >= 68 %} hum-high {% endif %}
                        {% if log.humidity_night >= 75 %} hum-danger {% endif %}
                    {% endif %}
                ">
                    {{ log.humidity_night|default_if_none:'' }}
                </td>
                <!--display 'ph' in color based on acidic/alkaline chart-->
                <td class="
                    {% if log.ph is not none %}
                        {% if log.ph < 2 %} ph-color-red {% endif %}
                        {% if log.ph >= 2 and log.ph < 4 %} ph-color-orange {% endif %}
                        {% if log.ph >= 4 and log.ph < 5.5 %} ph-color-yellow {% endif %}
                        {% if log.ph >= 5.5 and log.ph < 6.5 %} ph-color-green {% endif %}
                        {% if log.ph >= 6.5 and log.ph < 8.5 %} ph-color-blue {% endif %}
                        {% if log.ph >= 8.5 and log.ph < 10 %} ph-color-indigo {% endif %}
                        {% if log.ph >= 10 %} ph-color-violet {% endif %}
                       {% endif %}
                    ">
                    {{ log.ph|default_if_none:'' }}
                </td>
                <!--display 'ec' in color based on conductivity chart-->
                <td class="
                    {% if log.ec is not none %}
                        {% if log.ec < 0.8 %} ec-low {% endif %}
                        {% if log.ec >= 0.8 and log.ec < 1.2 %} ec-moderate {% endif %}
                        {% if log.ec >= 1.2 and log.ec < 1.4 %} ec-mid-high {% endif %}
                        {% if log.ec >= 1.4 and log.ec < 1.7 %} ec-high {% endif %}
                        {% if log.ec >= 1.7 and log.ec < 2.0 %} ec-very-high {% endif %}
                        {% if log.ec >= 2.0 %} ec-extreme {% endif %}
                       {% endif %}
                ">
                    {{ log.ec|default_if_none:'' }}
                </td>
                <!--display 'light_height' changes graphically in comparison to the previous log-->
                {% if log.get_previous_log.light_height > log.light_height %}
                <td style="padding-right: 15px;"><i class="fa-solid fa-arrow-down"></i>
                    {{ log.light_height|default_if_none:'' }}
                </td>
                {% elif log.get_previous_log.light_height < log.light_height %}
                <td style="padding-right: 15px;"><i class="fa-solid fa-arrow-up"></i>
                    {{ log.light_height|default_if_none:'' }}
                </td>
                {% else %}
                <td>{{ log.light_height|default_if_none:'' }}</td>
                {% endif %}
                <!--display 'light_power' graphically-->
                {% if log.light_power == 25 %}
                <td><i class="fa-solid fa-lightbulb"></i><i class="fa-regular fa-lightbulb"></i><i
                        class="fa-regular fa-lightbulb"></i><i class="fa-regular fa-lightbulb"></i></td>
                {% elif log.light_power == 50 %}
                <td><i class="fa-solid fa-lightbulb"></i><i class="fa-solid fa-lightbulb"></i><i
                        class="fa-regular fa-lightbulb"></i><i class="fa-regular fa-lightbulb"></i></td>
                {% elif log.light_power == 75 %}
                <td><i class="fa-solid fa-lightbulb"></i><i class="fa-solid fa-lightbulb"></i><i
                        class="fa-solid fa-lightbulb"></i><i class="fa-regular fa-lightbulb"></i></td>
                {% elif log.light_power == 100 %}
                <td><i class="fa-solid fa-lightbulb"></i><i class="fa-solid fa-lightbulb"></i><i
                        class="fa-solid fa-lightbulb"></i><i class="fa-solid fa-lightbulb"></i></td>
                {% else %}
                <td><i class="fa-regular fa-lightbulb"></i><i class="fa-regular fa-lightbulb"></i><i
                        class="fa-regular fa-lightbulb"></i><i class="fa-regular fa-lightbulb"></i></td>
                {% endif %}
                <!--display 'calibration' graphically-->
                {% if log.calibration %}
                <td><i class="fa-solid fa-check"></i></td>
                {% else %}
                <td style="size: 9px;"><i class="fa-solid fa-xmark"></i></td>
                {% endif %}
                <!--display 'carbon_dioxide' in color based on known ideal co2 levels for indoor growing and human health-->
                <td class="
                    {% if log.carbon_dioxide is not none %}
                        {% if log.carbon_dioxide <= 1000 %} carbon-dioxide-low {% endif %}
                        {% if log.carbon_dioxide > 1000 and log.carbon_dioxide < 1500 %} carbon-dioxide-ideal {% endif %}
                        {% if log.carbon_dioxide > 1500 and log.carbon_dioxide < 5000 %} carbon-dioxide-high {% endif %}
                        {% if log.carbon_dioxide >= 5000 and log.carbon_dioxide < 35000  %} carbon-dioxide-human-health-danger {% endif %}
                        {% if log.carbon_dioxide >= 35000 %} carbon-dioxide-human-health-danger-high {% endif %}
                    {% endif %}
                ">
                {% if log.carbon_dioxide > 5000 %}
                    <i class="fa-solid fa-triangle-exclamation"></i> {{ log.carbon_dioxide }}
                {% else %}
                    {{ log.carbon_dioxide|default_if_none:'' }}
                {% endif %}
                </td>
                <td></td>
                <td style="font-size: 10px">{{ log.irrigation|default_if_none:'' }}</td>
                <!--display 'nutrient_log' for Log as interactive button if exists or as + button if not-->
                {% if log.nutrient_logs.exists and not log.date == today %}
                <td style="text-align: center; vertical-align: middle;">
                    <button class="recipe-btn" style="margin: auto; margin-bottom: 4px"
                            onclick="openRecipeWindow('{% for nutrient_log in log.nutrient_logs.all %}<span class={{ nutrient_log.nutrient.nutrient_type|lower }}>{{ nutrient_log.nutrient.name }} - {{ nutrient_log.concentration|default_if_none:'' }}</span>{% if not forloop.last %}<br>{% endif %}{% endfor %}')">
                        Show
                    </button>
                </td>
                {% elif log.nutrient_logs.exists and log.date == today %}
                <td style="text-align: center; vertical-align: middle;">
                    <button class="recipe-btn-3-4" style="margin: auto; margin-bottom: 4px"
                            onclick="openRecipeWindow('{% for nutrient_log in log.nutrient_logs.all %}<span class={{ nutrient_log.nutrient.nutrient_type|lower }}>{{ nutrient_log.nutrient.name }} - {{ nutrient_log.concentration|default_if_none:'' }}</span>{% if not forloop.last %}<br>{% endif %}{% endfor %}')">
                        Show
                    </button>
                    <button class="plus-btn" style="margin: auto; margin-bottom: 4px"
                            onclick="location.href='{% url 'create_nutrient_log' pk=log.cycle.pk log_pk=log.pk %}'">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </td>
                {% elif not log.nutrient_logs.exists and log.date == today %}
                <td style="text-align: center; vertical-align: middle;">
                    <button class="plus-btn" style="margin: auto; margin-bottom: 4px"
                            onclick="location.href='{% url 'create_nutrient_log' pk=log.cycle.pk log_pk=log.pk %}'">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </td>
                {% else %}
                <td></td>
                {% endif %}
                <!--display additional options only if today in 'note' column besides comment-->
                {% if log.date == today %}
                <td class="comment-cell" {% if log.comment %}title="{{ log.comment }}" {% endif %}>
                    {% if log.comment %}
                    {{ log.comment|truncatechars:5|default_if_none:'' }}
                    |
                    {% endif %}
                    <span class="edit-icon"
                          onclick="location.href='{% url 'edit_log' pk=log.cycle.id log_pk=log.id %}'"><i
                            class="fa-solid fa-pen"></i></span>
                    <span class="delete-icon"
                          onclick="if(confirm('Are you sure you want to delete day {{ log.get_day_in_cycle }} | {{ log.phase }} log?')) { window.location.href = '{% url 'delete_log' pk=log.cycle.id log_pk=log.id %}'; } else { return false; }"><i
                            class="fa-regular fa-circle-xmark"></i></span>
                </td>
                {% else %}
                <td class="comment-cell"{% if log.comment %}title="{{ log.comment }}" {% endif %}>
                    {{ log.comment|truncatechars:10|default_if_none:'' }}
                </td>
                {% endif %}
            </tr>
            {% endfor %}
            </tbody>
        </table>
<button id="add-row-btn" class="create-log-btn" onclick="create_log('{{ cycle.pk }}')">Add</button>
</section>
<!--playground area-->
{% if avg_day_temp %}
<p>Average day temperature in veg phase: {{ avg_day_temp|floatformat:2 }}</p>
{% else %}
<p></p>
{% endif %}

<div class="online-icon"></div>
<i class="fa-solid fa-radiation"></i>
<i class="fa-sharp fa-solid fa-circle-radiation"></i>
<i class="fa-solid fa-circle-exclamation"></i>
<i class="fa-solid fa-triangle-exclamation"></i>
<i class="fa-solid fa-circle-half-stroke"></i>
<i class="fa-solid fa-circle"></i>
<i class="fa-duotone fa-circle-three-quarters-stroke"></i>
<i class="fa-regular fa-circle-xmark"></i>
<i class="fa-solid fa-xmark"></i>
<i class="fa-solid fa-xmark-large"></i>
<i class="fa-solid fa-droplet"></i>
<i class="fa-solid fa-eye-slash"></i>
<i class="fa-solid fa-camera"></i>
<i class="fa-solid fa-recycle"></i>
<i class="fa-solid fa-plus"></i>
<i class="fa-solid fa-arrow-up"></i>
<i class="fa-solid fa-arrow-down"></i>

<a href="{% url 'phase_summary' pk=cycle.id %}">Wrap Up</a>


{% endblock %}
</body>
</html>