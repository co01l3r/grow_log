<!DOCTYPE html>
<html lang="en">
{% extends 'main.html' %}
{% load static %}
<body>
{% block content %}
<section>
    <div class="cycle-info">
        <!--display genetics if name not provided-->
        {% if cycle.name %}
        <h1>{{ cycle.name }}</h1>
        {% else %}
        <h1>{{ cycle.genetics }}</h1>
        {% endif %}
    </div>

    <div class="tbl-header">
        <thead>
        <tr>
            <th class="cyc-info"><strong>Start:</strong> {{ cycle.date|date:"d/m/Y" }}</th>
            <!--display genetics if name not provided-->
            {% if cycle.name %}
            <th class="cyc-info"><strong>Genetics:</strong> {{ cycle.genetics }}</th>
            {% endif %}
            <th class="cyc-info"><strong>Seedbank:</strong> {{ cycle.seedbank|default:"Unknown"|title }},</th>
            <!--display 'behavioral_response', 'seed_type', 'grow_medium' only if data exists-->
            {% if cycle.behavioral_response %}
            <th class="cyc-info">{{ cycle.behavioral_response|title }},</th>
            {% endif %}
            {% if cycle.seed_type %}
            <th class="cyc-info">{{ cycle.seed_type|title }}</th>
            {% endif %}
            {% if cycle.grow_medium %}
            <th class="cyc-info"><strong>Medium:</strong> {{ cycle.grow_medium|title }}</th>
            {% endif %}
            <th class="cyc-info"><strong>Fixture:</strong> {{ cycle.fixture|title }}</th>
            <th><span class="edit-icon" data-href="{% url 'edit_record' cycle.pk %}"
                      onclick="window.open(this.getAttribute('data-href'), '_self')"><i
                    class="fa-solid fa-pen"></i></span></th>

            <th><span class="help-icon"
                      data-href="https://loudclouds.co/wp-content/uploads/2016/07/marijuana-deficiency-chart-jorge-cervantes.jpg"
                      onclick="window.open(this.getAttribute('data-href'), '_blank')"><i
                    class="fa-solid fa-cannabis"></i></span></th>
        </tr>
        </thead>
    </div>

    <br>
    <div class="tbl-header">
        <table cellpadding="0" cellspacing="0" border="0">
            <thead>
            <tr>
                <th style="padding-right: 25px;" rowspan="2">Day</th>
                <th colspan="2">Temperature</th>
                <th colspan="2">Humidity</th>
                <th>pH</th>
                <th>EC</th>
                <th>Light Height</th>
                <th>Light Power</th>
                <th>Calib.</th>
                <th>Water</th>
                <th>Irrigation</th>
                <th>Recipe</th>
                <th>Note</th>
            </tr>
            <tr>
                <th>Day</th>
                <th>Night</th>
                <th>Day</th>
                <th>Night</th>
                <th>ions</th>
                <th>mS/cm</th>
                <th>cm</th>
                <th>%</th>
                <th></th>
                <th>Litres</th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
            </thead>
        </table>
    </div>

    <div class="tbl-content">
        <table cellpadding="0" cellspacing="0" border="0">
            <tbody>
            {% for log in cycle.logs.all %}

            <!--change the row background every 7th day-->
            {% if forloop.counter|divisibleby:7 %}
            <tr style="background-color: rgba(255,255,255,0.1)">
                {% else %}
            <tr>
                {% endif %}
                <!--display log position formatted as: day_in_cycle (day_in_phase) phase-->
                {% if log.date == today %}
                <td style="text-align: left;">
                    {{ log.get_day_in_cycle }}
                    ({{ log.get_phase_day_in_cycle }})
                    {% if log.phase == "seedling" %}
                    <i class="fa-solid fa-seedling"></i>
                    {% elif log.phase == "vegetative" %}
                    <i class="fa-solid fa-circle"></i>
                    {% elif log.phase == "bloom" %}
                    <i class="fa-solid fa-circle-half-stroke"></i>
                    {% endif %}
                    <div class="online-icon"></div>
                </td>
                {% else %}
                <td style="text-align: left;">
                    {{ log.get_day_in_cycle }}
                    ({{ log.get_phase_day_in_cycle }})
                    {% if log.phase == "seedling" %}
                    <i class="fa-solid fa-circle"></i>
                    {% elif log.phase == "vegetative" %}
                    <i class="fa-solid fa-circle"></i>
                    {% elif log.phase == "bloom" %}
                    <i class="fa-solid fa-circle-half-stroke"></i>
                    {% endif %}
                </td>
                {% endif %}
                <td>{{ log.temperature_day|default_if_none:''|floatformat:1 }}</td>
                <td>{{ log.temperature_night|default_if_none:''|floatformat:1 }}</td>
                <td>{{ log.humidity_day|default_if_none:'' }}</td>
                <td>{{ log.humidity_night|default_if_none:'' }}</td>
                <td>{{ log.ph|default_if_none:'' }}</td>
                <td>{{ log.ec|default_if_none:'' }}</td>
                <td>{{ log.light_height|default_if_none:'' }}</td>
                <!--display 'light_power' graphically as bulbs-->
                {% if log.light_power == 25 %}
                <td><i class="fa-solid fa-lightbulb"></i><i class="fa-regular fa-lightbulb"></i><i
                        class="fa-regular fa-lightbulb"></i><i class="fa-regular fa-lightbulb"></i></td>
                {% elif log.light_power == 50 %}
                <td><i class="fa-solid fa-lightbulb"></i><i class="fa-solid fa-lightbulb"></i><i
                        class="fa-regular fa-lightbulb"></i><i class="fa-regular fa-lightbulb"></i></td>
                {% elif log.light_power == 75 %}
                <td><i class="fa-solid fa-lightbulb"></i><i class="fa-solid fa-lightbulb"></i><i
                        class="fa-solid fa-lightbulb"></i><i class="fa-regular fa-lightbulb"></i></td>
                {% elif log.light_power == 100 %}
                <td><i class="fa-solid fa-lightbulb"></i><i class="fa-solid fa-lightbulb"></i><i
                        class="fa-solid fa-lightbulb"></i><i class="fa-solid fa-lightbulb"></i></td>
                {% else %}
                <td><i class="fa-regular fa-lightbulb"></i><i class="fa-regular fa-lightbulb"></i><i
                        class="fa-regular fa-lightbulb"></i><i class="fa-regular fa-lightbulb"></i></td>
                {% endif %}
                <!--display 'calibration' graphically as icon-->
                {% if log.calibration %}
                <td><i class="fa-solid fa-check"></i></td>
                {% else %}
                <td><i class="fa-solid fa-xmark"></i></td>
                {% endif %}
                <td>{{ log.water|default_if_none:'' }}</td>
                <td style="font-size: 10px">{{ log.irrigation|default_if_none:'' }}</td>
                <!--display 'nutrient_log' for Cycle as interactive button if exists-->
                {% if log.nutrient_logs.exists %}
                <td style="text-align: center; vertical-align: middle;">
                    <button class="recipe-btn" style="margin: auto; margin-bottom: 4px"
                            onclick="openRecipeWindow('{% for nutrient_log in log.nutrient_logs.all %}<span class={{ nutrient_log.nutrient.nutrient_type|lower }}>{{ nutrient_log.nutrient.name }} - {{ nutrient_log.concentration|default_if_none:'' }}</span>{% if not forloop.last %}<br>{% endif %}{% endfor %}')">
                        Show
                    </button>
                </td>
                {% else %}
                <td></td>
                {% endif %}
                <!--display additional options only if today in 'note' column besides comment if exists-->
                {% if log.date == today %}
                <td class="log-cell" style="font-size: 10px; text-align: left;"
                    {% if log.comment %}title="{{ log.comment }}" {% endif %}>
                    {{ log.comment|truncatechars:5|default_if_none:'' }}
                    <span class="edit-icon"
                          onclick="location.href='{% url 'edit_log' pk=log.cycle.id log_pk=log.id %}'"><i
                            class="fa-solid fa-pen"></i></span>
                    <span class="delete-icon"
                          onclick="if(confirm('Are you sure you want to delete day {{ log.get_day_in_cycle }} | {{ log.phase }} log?')) { window.location.href = '{% url 'delete_log' pk=log.cycle.id log_pk=log.id %}'; } else { return false; }"><i
                            class="fa-solid fa-recycle"></i></span>
                </td>
                {% else %}
                <td class="log-cell" style="font-size: 10px; text-align: left;"
                    {% if log.comment %}title="{{ log.comment }}" {% endif %}>
                    {{ log.comment|truncatechars:10|default_if_none:'' }}
                </td>
                {% endif %}
            </tr>

            {% endfor %}
            </tbody>
        </table>
<button class="create-log-btn" onclick="create_log('{{ cycle.pk }}')">Add</button>
</section>

{% if avg_day_temp %}
<p>Average day temperature in veg phase: {{ avg_day_temp|floatformat:2 }}</p>
{% else %}
<p></p>
{% endif %}

<div class="online-icon"></div>
<i class="fa-solid fa-radiation"></i>
<i class="fa-sharp fa-solid fa-circle-radiation"></i>
<i class="fa-solid fa-circle-exclamation"></i>
<i class="fa-solid fa-triangle-exclamation"></i>
<i class="fa-solid fa-circle-half-stroke"></i>
<i class="fa-solid fa-circle"></i>
<i class="fa-duotone fa-circle-three-quarters-stroke"></i>

<a href="{% url 'phase_summary' pk=cycle.id %}">Wrap Up</a>


{% endblock %}
</body>
</html>